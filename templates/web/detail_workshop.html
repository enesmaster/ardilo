{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% block css %}
<style>
    .noselect {
        -webkit-touch-callout: none; /* iOS Safari */
          -webkit-user-select: none; /* Safari */
           -khtml-user-select: none; /* Konqueror HTML */
             -moz-user-select: none; /* Old versions of Firefox */
              -ms-user-select: none; /* Internet Explorer/Edge */
                  user-select: none; /* Non-prefixed version, currently
                                        supported by Chrome, Opera and Firefox */
    }
    .response {
        position: absolute;
        right: 60px;
        font-size: 22px;
        text-shadow: 0px 6px 6px #13ba99;
        font-weight: bold;
        font-family: 'Cerebri Sans', sans-serif;
    }
    #dots {
        font-size: 25px;
        position: absolute;
        right: 20px;
        top: 10px;
    }
    .snippet{
        font-family:Consolas, monospace;
        width: 125%;
        height: 100%;
        background-color: #0d1117;
        color:#f0f6fc;
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 10px;
        box-shadow: 0px 0px 5px #ccc;
    }
    .snippet .line_num{
        color: #6e7681;
    }
    .snippet .module{
        color: #ff7b72;
    }
    .snippet .variable{
        color: #ffa657;
    }
    .snippet .attr{
        color: #d2a8ff;
    }
    .snippet .comment{
        color: #8b949e;
    }
    .snippet .json{
        color: #7ee787;
    }
    .snippet .json2{
        color:  #9ac8ee;
    }
   .snippet .command{
       background:white;
       position: relative;
       width: 100%;
       height:1px;
   }
   .snippet  .code-file-title{
        color: #ff7b72;
        font-size: 19px;
        padding-bottom: 1px;
   }
   .snippet .line{
        background:white;
        position: absolute;
        width: 85%;
        height:1px;
        padding-top:0px;
    }
    .clipboard{
        position: absolute;
        right: -50px;
        top: 20px;
        font-size: 20px;
        cursor: pointer;
        text-align: center;
    }
    .download{
        position: absolute;
        right: -10px;
        top: 20px;
        font-size: 20px;
        cursor: pointer;
        text-align: center;
    }
</style>
{% endblock css %}
{% block content %}

<!-- home-agency start -->
<section class="hero-5 bg-light" id="home">
    <div class="container">
        <div class="row align-items-center justify-content-center">
            <div id="main" class="col-lg-2">
                <h1 id="main_title" class="mb-4 display-6 fw-semibold noselect">{% translate "Detail of the control" %} </h1>   
                <p id="main_p" class="text-muted fs-17 noselect">{% if request.user.is_authenticated %}{% if request.user.workshop %}{% translate "The inspiration is desire."%} {% else %}{% translate "Create your worksop. But first take a look to the documentation." %} {% endif %}{% else %}  {% translate "Register an account, define your url in your Arduino/NodeMCU IDE. That's it!" %}{% endif %}</p>
                <a href="{% url 'control_panel' %}" id="learn_btn" class="btn btn-lg btn-gradient-success mt-4 mb-4 mb-lg-1">{% translate "Controls"  %}<i class="mdi mdi-arrow-right fs-14 ms-1"></i></a>
            </div>
            {% if request.user.is_authenticated %}
            <div class="col-md-8 col-lg-5 offset-lg-1">
                <div class="snippet p-4">
                     <i title="Save" id="download_wksp" class='bx bx-download download' ></i>
                     <div class="mb-3" id="code-content">
                             <span class="code-file-title" >configs.json</span>
                             <br>
                             <span class="line"></span>
                             <br>
                             <span class="comment">// Save this variables to use in IoT device</span><br>
                             {<br>
                             <span class="json">"username"</span>: <span class="json2">"{{request.user.username}}"</span>,
                             <br>
                             <span class="json">"action-name"</span>: <span class="json2">"<span id="code-action-name">{{workshop.actname}}</span>"</span>,
                             <br>
                             <span class="json">"wifi"</span>: <span class="json2">"<span id="code-wifi">{{workshop.wifi.ssid }}</span>"</span>,
                             <br>
                             <span class="json">"secret-key"</span>: <span class="json2">"<span id="code-secret-key">{{workshop.secret_key}}</span>"</span>,
                             <br>
                             <span class="json">"URL"</span>: <span class="json2">"<span id="code-url">{{workshop.url}}</span>"</span>,
                             <br>}
                     </div>
                 </div>
            {% else %}
            <a href="{% url 'signup' %}"  class="btn btn-lg btn-gradient-success mt-4 mb-4 mb-lg-0">{% translate "Sign-Up"  %}<i class="mdi mdi-arrow-right fs-14 ms-1"></i></a>
            {% endif %}
        </div>
    </div>
 </section>
 <!-- home-agency end -->
{% endblock content %}
{% block script %}
<script>
    $('#clipboard-copied').css('background','#333333');
    $('#clipboard-copied').css('color','#fff');
    $('#clipboard-copied').css('border-radius','10%');
    $('#clipboard-copied').css('padding','5px');
    $('#clipboard-copied').css('font-size','15px');
    $('#clipboard-copied').css('font-family','Arial');
    
    $('#clipboard-copied').hide()


    $('#clipboard').click(function(){
        var copyText = $('#code-content-for-copy').text();
        $('#code-content-for-copy').select();
        navigator.clipboard.writeText(copyText);
        document.execCommand("copy");
        $('#clipboard').hide()
        $('#clipboard-copied').show()
        $('#clipboard-copied').html('Copied')
        setTimeout(function() {
            $('#clipboard-copied').html('')
            $('#clipboard').show()
            $('#clipboard-copied').hide()
        }, 1000);
    });
    $('#clipboard').mouseover(function() {
        $('#clipboard').removeClass('bx-copy-alt');
        $('#clipboard').addClass('bxs-copy');
    });
    $('#clipboard').mouseout(function() {
        $('#clipboard').removeClass('bxs-copy');
        $('#clipboard').addClass('bx-copy-alt');
    });
        // DOWNLOAD WORKSHOP INFO as JSON 
        $('#download_wksp').click(function(){
            $.ajax({
                    type: "POST",
                    url: "{% url 'config' %}",
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    data: {
                        'operation':'workshop_json',
                        'user':'{{ request.user.username }}',
                    },
                    dataType: "json",
                    success: function(response) {
                         if(response.success == true){
                            let j = document.createElement("a")
                            j.download = "workshop_cretidts_"+Date.now()+".json"
                            j.href = URL.createObjectURL(new Blob([JSON.stringify(response.json, null, 2)]))
                            j.click()
                        }
                         
                         else if(response.status==false){
                            console.log(response.status)
                            }
                        },
                        error: function(rs, e) {
                         console.log('error')
                        }
                  });
                })        
    </script>
{% endblock script %}