{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% block css %}

<style>
    .noselect {
        -webkit-touch-callout: none; /* iOS Safari */
          -webkit-user-select: none; /* Safari */
           -khtml-user-select: none; /* Konqueror HTML */
             -moz-user-select: none; /* Old versions of Firefox */
              -ms-user-select: none; /* Internet Explorer/Edge */
                  user-select: none; /* Non-prefixed version, currently
                                        supported by Chrome, Opera and Firefox */
      }
      .response {
        position: absolute;
        right: 60px;
        font-size: 22px;
        text-shadow: 0px 6px 6px #13ba99;
        font-weight: bold;
        font-family: 'Cerebri Sans', sans-serif;
      }
      #dots {
        font-size: 25px;
        position: absolute;
        right: 20px;
        top: 10px;
        cursor:pointer;
      }
</style>
{% endblock css %}
{% block content %}

<!-- home-agency start -->
<section class="hero-5" id="home">
    <div class="container">
        <div class="row align-items-center justify-content-center">
            <div id="main" class="col-lg-2">
                <h1 id="main_title" class="mb-4 display-6 fw-semibold noselect">{% translate "Control buttons" %} </h1>
                <p id="main_p" class="text-muted fs-17 noselect">{% if request.user.is_authenticated %}{% if request.user.workshop %}{% translate "Control your projects by pressing the buttons"%} {% else %}{% translate "Create your worksop. But first take a look to the documentation." %} {% endif %}{% else %}  {% translate "Register an account, define your url in your Arduino/NodeMCU IDE. That's it!" %}{% endif %}</p>
                <a href="{% url 'docs' %}" id="learn_btn" class="btn btn-lg btn-gradient-success mt-4 mb-4 mb-lg-0">{% translate "Learn More"  %}<i class="mdi mdi-arrow-right fs-14 ms-1"></i></a>
            </div>

            {% if request.user.is_authenticated %}
            <div class="col-md-8 col-lg-5 offset-lg-1">
                {% for workshop in workshops %}
                <div class="card mb-3" id="card">
                    <div class="card-body p-4 ">
                        <i class='bx bx-dots-horizontal-rounded' id="dots"> <a target="_blank" href="{{workshop.url}}">link</a></i>
                        <h5 id="wifi_h5" class="border-bottom text-center fs-22 pb-2 mb-4 noselect">{{workshop.actname}}</h5>
                        <p id="response" class="response">{{workshop.current_resp}}</p>
                        <a data-workshop-id="{{ workshop.id }}" data-workshop-def="{{ workshop.def_resp }}" data-workshop-exp="{{ workshop.expected_resp }}" class="btn btn-md btn-gradient-success mt-0 mb-4 mb-lg-0 wake">{{workshop.expected_resp|title}}<i class="mdi mdi-arrow-right fs-14 ms-1"></i></a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <a href="{% url 'signup' %}"  class="btn btn-lg btn-gradient-success mt-4 mb-4 mb-lg-0">{% translate "Sign-Up"  %}<i class="mdi mdi-arrow-right fs-14 ms-1"></i></a>
            

            {% endif %}
        </div>
    </div>
 </section>
 <!-- home-agency end -->

<input id="this_username" type="hidden" value=""></input>
{% endblock content %}
{% block script %}
<script>
    $('.wake').click(function(){
        var workshop_id = $(this).attr('data-workshop-id');
        var workshop_def = $(this).attr('data-workshop-def');
        var workshop_exp = $(this).attr('data-workshop-exp');
            $.ajax({
                type: "POST",workshop_id,
                url: "{% url 'control_panel' %}",
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                data: {
                    'operation':'wake',
                    'workshop_id':workshop_id,
                    'workshop_def':workshop_def,
                    'workshop_exp':workshop_exp},
                dataType: "json",
                success: function(response) {
                     if(response.success == true){
                        a = $("[data-workshop-id='"+workshop_id+"']");
                        $(a).siblings('#response').text(response.response);
                        $(a).text(response.resp_btn);
                        $(a).text(function(i) {
                            return a.text().substr(0,1).toUpperCase() + a.text().substr(1);
                        });
                        
                     }
                     else if(response.status==false){
                       console.log(response.status)
                     }
                     else if(response.status=='duplicate'){
                        $('#wifi_alert_p').show()
                        $('#wifi_alert_p').html(response.msg)
                        setTimeout(function(){
                            $('#wifi_alert_p').hide()
                        },12000)
                    }
                 },
                 error: function(rs, e) {
                  console.log('error')
                 }
           }); 
        });
</script>

{% endblock script %}